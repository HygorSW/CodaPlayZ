<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Spotify Web Player com Autoplay</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    #player {
      background: #1db954;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      text-align: center;
    }
    button {
      background: #191414;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #1ed760;
      color: black;
    }
    #track-info {
      margin: 15px 0;
    }
  </style>
</head>
<body>

  <div id="player">
    <h2>Spotify Player</h2>
    <div id="track-info">Carregando...</div>
    <button id="prev">⏮️ Anterior</button>
    <button id="play">▶️ Tocar</button>
    <button id="pause" style="display:none;">⏸️ Pausar</button>
    <button id="next">⏭️ Próximo</button>
  </div>

  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script>
    // Seu token de acesso válido com escopos corretos (streaming, user-read-playback-state, etc)
    const token = 'BQBHvchYRU5QXhphb38j-wK8HCrxWiKFcJA5ushj3x_P3SAKCs1eu2fgFgg3DkMI7winaP4vCvbEs40KsoQCPLx7VIk6GWis3b-4_4UpvahS-Ub-kmJ61v-l9o-gzDl6t20g6K_9EZg';

    // URIs das músicas que quer tocar (pode colocar 1 ou várias)
    const tracksToPlay = [
      'spotify:track:5yzO9eaFRySY6G6RjtUFZY',
      'spotify:track:5KXXi90Q4pjVxEapZjRC9O'
    ];

    window.onSpotifyWebPlaybackSDKReady = () => {
      const player = new Spotify.Player({
        name: 'Meu Web Player',
        getOAuthToken: cb => { cb(token); },
        volume: 0.5
      });

      player.addListener('initialization_error', ({ message }) => { console.error(message); });
      player.addListener('authentication_error', ({ message }) => { console.error('Erro autenticação:', message); });
      player.addListener('account_error', ({ message }) => { console.error('Erro conta:', message); });
      player.addListener('playback_error', ({ message }) => { console.error('Erro playback:', message); });

      player.addListener('player_state_changed', state => {
        if (!state) {
          document.getElementById('track-info').textContent = 'Nenhuma música tocando';
          return;
        }
        const currentTrack = state.track_window.current_track;
        document.getElementById('track-info').textContent = `${currentTrack.name} — ${currentTrack.artists.map(artist => artist.name).join(', ')}`;
        if (state.paused) {
          document.getElementById('play').style.display = 'inline-block';
          document.getElementById('pause').style.display = 'none';
        } else {
          document.getElementById('play').style.display = 'none';
          document.getElementById('pause').style.display = 'inline-block';
        }
      });

      player.addListener('ready', ({ device_id }) => {
        console.log('Pronto com Device ID', device_id);
        window.device_id = device_id;
        transferPlaybackHere(device_id).then(() => {
          playTracks(device_id, tracksToPlay);
        });
      });

      player.addListener('not_ready', ({ device_id }) => {
        console.log('Dispositivo saiu do ar', device_id);
      });

      player.connect();

      // Transferir playback para o Web Player
      async function transferPlaybackHere(device_id) {
        return fetch('https://api.spotify.com/v1/me/player', {
          method: 'PUT',
          body: JSON.stringify({
            "device_ids": [device_id],
            "play": false
          }),
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
        });
      }

      // Iniciar a reprodução das faixas
      async function playTracks(device_id, uris) {
        try {
          const response = await fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
            method: 'PUT',
            body: JSON.stringify({ uris }),
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
          });
          if (response.status === 204) {
            console.log('Playback iniciado!');
          } else {
            const errorData = await response.json();
            console.error('Erro ao iniciar playback:', errorData);
          }
        } catch (error) {
          console.error('Erro na requisição de playback:', error);
        }
      }

      // Controles dos botões
      document.getElementById('play').onclick = () => {
        player.resume().catch(console.error);
      };
      document.getElementById('pause').onclick = () => {
        player.pause().catch(console.error);
      };
      document.getElementById('next').onclick = () => {
        player.nextTrack().catch(console.error);
      };
      document.getElementById('prev').onclick = () => {
        player.previousTrack().catch(console.error);
      };
    };
  </script>

</body>
</html>
